<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Xem Truy·ªán</title>
  <style>
    body {
      font-family: 'Merriweather', serif;
      background: #fdf9f0;
      color: #4a3c2a;
      max-width: 860px;
      margin: 40px auto;
      padding: 30px;
      border: 2px solid #d4af37;
      border-radius: 15px;
      box-shadow: 0 12px 30px rgba(139, 115, 85, 0.2);
    }
    h1 {
      font-size: 2.4rem;
      color: #8b7355;
      margin-bottom: 10px;
      text-align: center;
    }
    .category {
      text-align: center;
      font-style: italic;
      color: #a0845c;
      margin-bottom: 25px;
      border-bottom: 2px dashed #d4af37;
      padding-bottom: 5px;
    }
    .content {
      padding-top: 20px;
      line-height: 1.8;
    }
    .content img, .content video {
      max-width: 100%;
      border-radius: 8px;
      margin: 10px 0;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .buttons {
      margin-top: 40px;
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    .btn {
      padding: 12px 24px;
      border-radius: 30px;
      font-weight: bold;
      font-size: 1rem;
      text-decoration: none;
      display: inline-block;
      box-shadow: 0 4px 15px rgba(139, 115, 85, 0.2);
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }
    .btn-home {
      background: linear-gradient(45deg, #f5c16c, #e6b65a);
      color: #4a3c2a;
    }
    .btn-home:hover {
      background: linear-gradient(45deg, #eac472, #dba949);
    }
    .btn-edit {
      background: linear-gradient(45deg, #a0845c, #8b7355);
      color: #fffaf0;
    }
    .btn-edit:hover {
      background: linear-gradient(45deg, #8b7355, #705e45);
    }
    .btn-delete {
      background: linear-gradient(45deg, #d66, #c44);
      color: #fffaf0;
    }
    .btn-delete:hover {
      background: linear-gradient(45deg, #c33, #a11);
    }
    .btn-clear {
      background: linear-gradient(45deg, #ddd6c1, #c5b79f);
      color: #4a3c2a;
    }
    .btn-clear:hover {
      background: linear-gradient(45deg, #ccc1a5, #b7a78c);
    }
    .message {
      text-align: center;
      color: #a0845c;
      font-style: italic;
      margin-top: 30px;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <h1 id="storyTitle"></h1>
  <p class="category">üëÅÔ∏è L∆∞·ª£t xem: <span id="storyViews">0</span></p>
  <div class="content" id="storyContent"></div>

  <div class="buttons">
    <a href="home.html" class="btn btn-home">üè† Trang Ch·ªß</a>
    <button class="btn btn-edit" onclick="editStory()">‚úèÔ∏è S·ª≠a Truy·ªán</button>
    <button class="btn btn-delete" onclick="deleteStory()">üóëÔ∏è X√≥a Truy·ªán</button>
    <button class="btn btn-clear" onclick="suggestNewStory()">üîÅ ƒê·ªçc Truy·ªán M·ªõi</button>
  </div>

  <script>
    const story = JSON.parse(localStorage.getItem('selectedStory'));
    document.getElementById('storyViews').textContent = story.views || 0;
    // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£t xem
if (story) {
    let stories = JSON.parse(localStorage.getItem("stories") || "[]");
    const index = stories.findIndex(s => s.id === story.id);
    if (index !== -1) {
        stories[index].views = (stories[index].views || 0) + 1;
        localStorage.setItem("stories", JSON.stringify(stories));
        story.views = stories[index].views; // c·∫≠p nh·∫≠t l·∫°i object hi·ªán t·∫°i
    }
}

function suggestNewStory() {
    const currentStory = JSON.parse(localStorage.getItem("selectedStory"));
    const stories = JSON.parse(localStorage.getItem("stories") || "[]");

    // L·ªçc ra nh·ªØng truy·ªán KH√îNG ph·∫£i truy·ªán ƒëang ƒë·ªçc
    const otherStories = stories.filter(s => s.id !== currentStory?.id);

    if (otherStories.length === 0) {
        alert("üìö Hi·ªán b·∫°n ch·ªâ c√≥ m·ªôt truy·ªán, kh√¥ng c√≤n truy·ªán n√†o kh√°c ƒë·ªÉ ƒë·ªÅ xu·∫•t!");
        return;
    }

    // ƒê·ªÅ xu·∫•t ng·∫´u nhi√™n
    const randomIndex = Math.floor(Math.random() * otherStories.length);
    const suggestedStory = otherStories[randomIndex];

    localStorage.setItem("selectedStory", JSON.stringify(suggestedStory));
    location.reload(); // t·∫£i l·∫°i view.html ƒë·ªÉ hi·ªÉn th·ªã truy·ªán m·ªõi
}

    if (!story) {
      document.body.innerHTML = `
        <p class="message">‚ùå Kh√¥ng t√¨m th·∫•y truy·ªán. Vui l√≤ng quay l·∫°i trang ch·ªß.</p>
        <div class="buttons">
          <a href="home.html" class="btn btn-home">üè† Trang Ch·ªß</a>
        </div>
      `;
    } else {
      document.getElementById('storyTitle').textContent = story.title;
      document.getElementById('storyContent').innerHTML = story.content;
    }

    function editStory() {
      if (!story) return;
      localStorage.setItem('editStoryId', story.id);
      localStorage.setItem('selectedStory', JSON.stringify(story));
      window.location.href = 'create.html';
    }

    function deleteStory() {
    if (!story || !confirm("‚ùå B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a truy·ªán n√†y kh√¥ng?")) return;
    let stories = JSON.parse(localStorage.getItem("stories") || "[]");
    stories = stories.filter(s => s.id !== story.id);
    localStorage.setItem("stories", JSON.stringify(stories));
    alert("‚úÖ Truy·ªán ƒë√£ ƒë∆∞·ª£c x√≥a th√†nh c√¥ng.");
    window.location.href = "home.html";
}

    function clearStory() {
      localStorage.removeItem('selectedStory');
      location.reload();
    }
  </script>
</body>
</html>
